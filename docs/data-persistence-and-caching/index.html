<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-ConfigurationOptions/data-persistence-and-caching">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Data Persistence and Caching | Cloud Carbon Footprint</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cloud-carbon-footprint.github.io/docs/data-persistence-and-caching"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Data Persistence and Caching | Cloud Carbon Footprint"><meta data-rh="true" name="description" content="Calculating estimates can take time and you may wish for a way to persist data to speed up performance of subsequent calls to the API."><meta data-rh="true" property="og:description" content="Calculating estimates can take time and you may wish for a way to persist data to speed up performance of subsequent calls to the API."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://cloud-carbon-footprint.github.io/docs/data-persistence-and-caching"><link data-rh="true" rel="alternate" href="https://cloud-carbon-footprint.github.io/docs/data-persistence-and-caching" hreflang="en"><link data-rh="true" rel="alternate" href="https://cloud-carbon-footprint.github.io/docs/data-persistence-and-caching" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://L8RY6HBDJZ-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Cloud Carbon Footprint RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Cloud Carbon Footprint Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Cloud Carbon Footprint" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.c3e29cd2.css">
<link rel="preload" href="/assets/js/runtime~main.cb91f6b3.js" as="script">
<link rel="preload" href="/assets/js/main.8fe9b0da.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Cloud Carbon Footprint</b></a><a class="navbar__item navbar__link navbar__link" href="/docs/getting-started">Get Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://demo.cloudcarbonfootprint.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__link">Demo</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/cloud-carbon-footprint/cloud-carbon-footprint" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__link">Github</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/methodology">How it Works</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/methodology">Methodology</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/embodied-emissions">Embodied Emissions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/classifying-usage-types">Classifying Usage Types</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/introduction">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/aws">Connecting Data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/data-persistence-and-caching">Configuration Options</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/data-persistence-and-caching">Data Persistence and Caching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance-considerations">Performance Considerations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tagging">Tagging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/configurations-glossary">Configurations Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/emissions-factors">Emissions Factors</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/backstage-plugins">Integrations</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Configuration Options</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Data Persistence and Caching</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Data Persistence and Caching</h1></header><p>Calculating estimates can take time and you may wish for a way to persist data to speed up performance of subsequent calls to the API.
We offer the following data caching methods of varying levels of simplicity and power for saving estimates after they are calculated:</p><ul><li>JSON File (default, but will be deprecated)<ul><li>Local filesystem (default, no configuration needed)</li><li>Google Cloud Storage</li></ul></li><li>MongoDB (local or cloud database)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="json-file">JSON File<a href="#json-file" class="hash-link" aria-label="Direct link to JSON File" title="Direct link to JSON File">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-filesystem">Local Filesystem<a href="#local-filesystem" class="hash-link" aria-label="Direct link to Local Filesystem" title="Direct link to Local Filesystem">​</a></h3><p>To make local development a pleasant experience with a quick feedback loop, we have a no-setup local caching method that uses a JSON file that is automatically generated. This file will be created in either the packages/api or packages/cli directory – typically with the name of the grouping method included (i.e. <code>estimates.month.cache.json</code>. If you would like to see up-to-date estimates, you will have to delete <code>packages/cli/estimates.[grouping].cache.json</code> and/or <code>packages/api/estimates.[grouping].cache.json</code>. Depending on how much usage you have, it could take several minutes to fetch up-to-date estimates and regenerate the cache file.
Note: If you don’t see one of these files, don’t worry. Simply start the server, and load the app for the first time.</p><p>Currently, this caching method is planned to be deprecated and will receive decreased support for incoming features made to the app. This is due to its poor scalability which creates issues for those with very large usage data on a typical enterprise or organizational scale. However, it is a great way to get up and start with the app quickly and still appropriate for small-scale users.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="google-cloud-storage">Google Cloud Storage<a href="#google-cloud-storage" class="hash-link" aria-label="Direct link to Google Cloud Storage" title="Direct link to Google Cloud Storage">​</a></h3><p>As an expansion to the local cache method, you can use the same JSON file generation within a Google Cloud Storage bucket. If you are experiencing long load times in your staging or production environments, or simply wish to forego the local filesystem, the option to store a JSON cache file in the cloud may be the best option for you. This could be especially helpful in improving re-estimate speeds for your deployed environments. In order to use the Google Cloud option, you have to set the following variables in your <code>packages/api/.env</code> or <code>packages/cli/.env</code> file:</p><div class="language-Dotenv codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Dotenv codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CACHE_MODE=GCS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GCS_CACHE_BUCKET_NAME=”some-bucket-name”</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Note: The Google service account that you are using must have access and permissions to read/write into the bucket.</em></p><p><strong>Note on Memory Limitations:</strong>
For JSON Filesystem cache modes, CCF uses read and write streams to get and set estimates. Ultimately, this helps avoid running into JS memory limitations when inevitably needing to stringify the data. The set back for this approach as the data scales is when sending through the REST API result. With express, the JSON response value passed through will need to get stringified. Usually once the data size reaches around 500 mb is when you might see an issue like:</p><p><code>RangeError: Invalid string length</code></p><p>For this reason, we have chosen to focus our support on the MongoDB cache mode, where we have implemented pagination for the REST API response which will scale better and avoid the memory limitations. We believe the JSON File cache mode is a good choice for smaller data sets.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mongodb-storage">MongoDB Storage<a href="#mongodb-storage" class="hash-link" aria-label="Direct link to MongoDB Storage" title="Direct link to MongoDB Storage">​</a></h2><p>Users or organizations with large amounts of usage data may have difficulty using the default local caching method. For those wishing to persist a larger scale of data, we offer the option of configuring a MongoDB instance to store your estimates. Similar to the local cache system, this method will also speed up subsequent calls to the API and is the recommended and fully supported caching method.</p><p>CCF currently supports either a manual local instance via MongoDB Community/Enterprise, or an automated cloud instance via MongoDB Atlas or similar platform.</p><p>To use this configuration, first set up a MongoDB instance of your choice:</p><ul><li><a href="https://www.mongodb.com/docs/atlas/getting-started/" target="_blank" rel="noopener noreferrer">Local Instance Manual Setup</a></li><li><a href="https://www.mongodb.com/docs/v6.0/installation/" target="_blank" rel="noopener noreferrer">MongoDB Atlas Setup</a></li></ul><p>After setting up a new instance or collection to be used for CCF, configure the following environment variables in your packages/api or packages/cli/.env file:</p><div class="language-.env codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-.env codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CACHE_MODE=MONGODB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MONGODB_URI=mongodb://example-uri</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MONGODB_CREDENTIALS=/path-to-credentials.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>The MONGODB_URI variable should be set to the connection URI of your MongoDB instance. If using Atlas, you should find this option in the Connect section of your Atlas cluster. For a local instance, the default string is usually <code>mongodb://localhost:27017</code> while the service is running.</li><li>The MONGODB_CREDENTIALS variable is optionally used when configuring MongoDB Atlas. CCF will need the credentials to be stored and referenced in order to connect.</li></ul><p>Example of usage in MongoDB Atlas:</p><div class="language-.env codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-.env codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CACHE_MODE=MONGODB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MONGODB_URI=mongodb+srv://user:password@cluster-uri</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After calculating estimates for the first time, the app will create a new collection titled “ccf”. Estimates will be separated into timestamps and stored into a collection that is named according to the current grouping method (i.e. “estimates-by-month).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="paginating-estimates">Paginating Estimates<a href="#paginating-estimates" class="hash-link" aria-label="Direct link to Paginating Estimates" title="Direct link to Paginating Estimates">​</a></h3><p>Since the MongoDB storage method is capable of storing a large amount of estimates, it is possible the estimates for a requested date range will exceed the ideal size of a REST API response. To accommodate this, we have enabled pagination when fetching estimates using this method alongside the CCF client or querying the API directly.</p><p>We have added a configurable limit value used to paginate the data through the client package. <code>REACT_APP_PAGE_LIMIT</code> will default to paginating through 1000 documents at a time, but depending on the overall collection size, the limit value can be set to whatever makes the most sense.</p><p>When consuming the API directly, you can still take advantage of the paginated feature by configuring it through the use of parameters when querying the /footprint endpoint.
There will need to be additional logic written to loop through multiple requests and paginate the data depending on the specified limit value.</p><p>A sample request using limit and skip parameters may look like:</p><div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/footprint?start=2021-01-01&amp;end=2021-02-01&amp;limit=30&amp;skip=10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Skip: The number of estimates (MongoDB documents) to skip over</li><li>Limit: The maximum number of estimates (MongoDB documents) to include in the request (&lt;=50000)</li></ul><p><em>Note: This feature only works when the MONGODB cache mode is enabled. The limit and skip parameters will be ignored for other cache modes.</em></p><p><em>To avoid potential issues with memory limitations when loading and aggregating estimates from the cache, a default value of 50,000 documents will be used for the page limit.
This ensures that individual timestamps with significantly large amount of estimates are handled properly. Custom limit values that exceed this number will result in a validation error.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="filtering-estimates">Filtering Estimates<a href="#filtering-estimates" class="hash-link" aria-label="Direct link to Filtering Estimates" title="Direct link to Filtering Estimates">​</a></h3><p>With the MongoDB cache mode, CCF is now supporting the capability to filter estimates by the following keys and request parameters:</p><ul><li><strong>cloudProviders</strong> (AWS | GCP | Azure)</li><li><strong>accounts</strong> (via account id)</li><li><strong>services</strong> (i.e. AmazonDynamoDB)</li><li><strong>regions</strong> (i.e. us-east-1)</li><li><strong>tags</strong> (via key/value pairs)</li></ul><p>A sample request to filter by cloud providers may look like:</p><div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/footprint?start=2021-01-01&amp;end=2021-02-01&amp;limit=30&amp;skip=10&amp;cloudProviders=AWS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Multiple filters can be provided even within the same key, for example:</p><p><code>&amp;cloudProviders=AWS&amp;cloudProviders=GCP</code></p><p><em>A note on tags:</em>
As tagging for our supported cloud service providers is typically set up using key value pairs, the parameters must be set up to handle this appropriately. For example, if you have a tag in AWS called <code>aws:CreatedBy</code> and the value is the username, the request parameter should look like:</p><p><code>&amp;tags[aws:CreatedBy]=username</code></p><p><em>Note: Filtering for Mongodb will only work to filter existing cached data in the collection. Providing these parameters for the initial request to the CSP’s will not return filtered data.</em></p><p><em>Filtering is only supported via the API and is not yet supported on the client.</em></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="caching-configurations">Caching Configurations<a href="#caching-configurations" class="hash-link" aria-label="Direct link to Caching Configurations" title="Direct link to Caching Configurations">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ensure-real-time-estimates">Ensure Real-Time Estimates<a href="#ensure-real-time-estimates" class="hash-link" aria-label="Direct link to Ensure Real-Time Estimates" title="Direct link to Ensure Real-Time Estimates">​</a></h3><p>In order to make local development a pleasant experience with a quick feedback loop, we have a cache file that is automatically generated. If you would like to see up-to-date estimates, you will have to delete <code>packages/cli/estimates.cache.json</code> and/or <code>packages/api/estimates.cache.json</code>. If you are using MongoDB or GCS to store estimates, you will either have to delete the collection or the estimates file in the storage bucket respectively. Depending on how much usage you have, it could take several minutes to fetch up-to-date estimates and regenerate the cache file.</p><p>There is also an optional boolean parameter that can be set to ignore setting estimates to a cache:</p><p><code>ignoreCache=true</code></p><p>Or when using the client, you can set an optional environment variable:</p><p><code>DISABLE_CACHE=true</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="seeding-cache-file">Seeding Cache File<a href="#seeding-cache-file" class="hash-link" aria-label="Direct link to Seeding Cache File" title="Direct link to Seeding Cache File">​</a></h2><p>We have an option to run the server-side API calls as a background job. This can be useful for larger amounts of data to query from the cloud providers and will have no timeout limit when running with the browser. Before running the script, you will need to set the necessary configurations in a <code>.env</code> file in the CLI directory.</p><p>From the root directory, run:</p><p><code>yarn seed-cache-file</code></p><p>You will then be prompted to enter a start date, end date and groupBy parameter. </p><p>Optionally, you can specify a specific cloud provider to seed. This will allow you to append estimations to given dates in your requested time frame that may be missing from a newly configured cloud provider (currently only supported with a MongoDB caching mode).</p><p>Once this process is finished running, estimates will either be saved to a newly created JSON file in the <code>packages/cli</code> directory or into your configured MongoDB instance. If using the JSON method, in order to use the cache file to run with the front-end client package, you will have to copy the cache file to the API directory before starting the application.</p><p><em>Note: If you end up seeing an error due to memory limitations, you will either have to adjust to a smaller date range or change the grouping method.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fetch-methods">Fetch Methods<a href="#fetch-methods" class="hash-link" aria-label="Direct link to Fetch Methods" title="Direct link to Fetch Methods">​</a></h3><p>When starting the cache file seeding, one of the last prompts will ask you to specify a fetch method for the requests that the script will make. This allows for greater flexibility with handling date ranges with potentially large data that will be too large to calculate in a single API request. You will be presented with the following options:</p><ul><li><strong>Single</strong> - Seed the cache file using a <em>single request</em> to the API (Default)</li><li><strong>Split</strong> -  Seed the cache file using multiple requests split according to specified number of days</li></ul><p>By default, the script will fetch estimates using a single request.</p><p>If you choose to split your requests, you will be asked an optional follow-up question of how many days to fetch per request. This will allow it to fetch the provided number of days or to fetch a default of one day per request until the date range is covered.</p><p>We recommend using this method when dealing with a large amount of usage data within a date range that may cause issues when running your app, especially for historical data, as described in the <a href="/docs/performance-considerations">Performance Considerations</a> section.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/alternative-data-approaches"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Alternative Data Approaches</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/performance-considerations"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Performance Considerations</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#json-file" class="table-of-contents__link toc-highlight">JSON File</a><ul><li><a href="#local-filesystem" class="table-of-contents__link toc-highlight">Local Filesystem</a></li><li><a href="#google-cloud-storage" class="table-of-contents__link toc-highlight">Google Cloud Storage</a></li></ul></li><li><a href="#mongodb-storage" class="table-of-contents__link toc-highlight">MongoDB Storage</a><ul><li><a href="#paginating-estimates" class="table-of-contents__link toc-highlight">Paginating Estimates</a></li><li><a href="#filtering-estimates" class="table-of-contents__link toc-highlight">Filtering Estimates</a></li></ul></li><li><a href="#caching-configurations" class="table-of-contents__link toc-highlight">Caching Configurations</a><ul><li><a href="#ensure-real-time-estimates" class="table-of-contents__link toc-highlight">Ensure Real-Time Estimates</a></li></ul></li><li><a href="#seeding-cache-file" class="table-of-contents__link toc-highlight">Seeding Cache File</a><ul><li><a href="#fetch-methods" class="table-of-contents__link toc-highlight">Fetch Methods</a></li></ul></li></ul></div></div></div></div></main></div></div><div><div class="footerLicenseContainer_aMKa"><a class="footerLicenseLink_V4Yd signature_Phj5" target="_blank" href="https://www.thoughtworks.com">Made for the 🌎 by Thoughtworks</a><p>Cloud Carbon Footprint is an open-source project, sponsored by Thoughtworks Inc. under the <a class="footerLicenseLink_V4Yd undefined" target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a></p><p><a class="footerLicenseLink_V4Yd undefined" target="_blank" href="https://www.thoughtworks.com/privacy-policy">PRIVACY POLICY</a></p></div></div></div>
<script src="/assets/js/runtime~main.cb91f6b3.js"></script>
<script src="/assets/js/main.8fe9b0da.js"></script>
</body>
</html>